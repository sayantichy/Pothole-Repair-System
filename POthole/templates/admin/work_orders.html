{% extends "base.html" %}
{% block content %}

<div class="d-flex justify-content-between align-items-center mb-3">
  <h1 class="h4 mb-0">Work Orders</h1>
  <a class="btn btn-outline-danger btn-sm" href="{{ url_for('auth.logout') }}">Logout</a>
</div>

<form class="row g-2 mb-3" method="get">
  <div class="col-auto">
    <select class="form-select" name="crew_id">
      <option value="" {{ 'selected' if not selected_crew }}>All crews</option>
      {% for c in crews %}
        <option value="{{ c.id }}" {{ 'selected' if (selected_crew|string)==(c.id|string) }}>{{ c.name }} ({{ c.crew_number }})</option>
      {% endfor %}
    </select>
  </div>
  <div class="col-auto">
    <select class="form-select" name="status">
      <option value="" {{ 'selected' if not selected_status }}>All status</option>
      {% for s in ['planned','in_progress','paused','completed','canceled'] %}
        <option value="{{ s }}" {{ 'selected' if selected_status==s }}>{{ s }}</option>
      {% endfor %}
    </select>
  </div>
  <div class="col-auto"><button class="btn btn-outline-secondary">Filter</button></div>
</form>

<table class="table table-sm align-middle">
  <thead><tr><th>ID</th><th>Crew</th><th>Pothole</th><th>Status</th><th class="text-end">Update</th></tr></thead>
  <tbody>
    {% for w in orders %}
      <tr>
        <td>{{ w.id }}</td>
        <td>{{ w.crew.name if w.crew else '-' }}</td>
        <td><a href="{{ url_for('public.track', public_id=w.pothole.public_id) }}" target="_blank">{{ w.pothole.street_address }}</a></td>
        <td>{{ w.status }}</td>
        <td class="text-end">
          <form method="post" action="{{ url_for('admin.set_work_order_status') }}" class="d-inline-flex gap-2">
            <input type="hidden" name="wo_id" value="{{ w.id }}">
            <select name="status" class="form-select form-select-sm">
              {% for s in ['planned','in_progress','paused','completed','canceled'] %}
                <option value="{{ s }}" {{ 'selected' if w.status==s }}>{{ s }}</option>
              {% endfor %}
            </select>
            <button class="btn btn-sm btn-outline-primary">Update</button>
          </form>
        </td>
      </tr>
    {% else %}
      <tr><td colspan="5" class="text-muted p-3">No work orders.</td></tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}
